<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Storage Buckets API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 82ce88815, updated Thu Sep 7 16:33:55 2023 -0700" name="generator">
  <link href="https://wicg.github.io/storage-buckets/" rel="canonical">
  <meta content="2f26bf4f909bb51208d507f9100ea1799fd0a000" name="document-revision">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
</style>
<style>/* Boilerplate: style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */


@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Storage Buckets API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2023-10-03">3 October 2023</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/storage-buckets/">https://wicg.github.io/storage-buckets/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/storage-buckets/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:estade@google.com">Evan Stade</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:ayui@google.com">Ayu Ishii</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dt class="editor">Former Editor:
     <dd class="editor p-author h-card vcard"><span class="p-name fn">Victor Costan</span>
     <dt>Participate:
     <dd><a href="https://github.com/WICG/storage-buckets">GitHub WICG/storage-buckets</a> (<a href="https://github.com/WICG/storage-buckets/issues/new">new issue</a>, <a href="https://github.com/WICG/storage-buckets/issues?state=open">open issues</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 the Contributors to the Storage Buckets API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The Storage Buckets API provides a way for sites to organize locally stored data into groupings called "storage buckets". This allows the user agent or sites to manage and delete buckets independently rather than applying the same treatment to all the data from a single origin.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#storage-bucket-manager"><span class="secno">1</span> <span class="content">The <code class="idl"><span>StorageBucketManager</span></code> interface</span></a>
     <ol class="toc">
      <li><a href="#storage-bucket-open"><span class="secno">1.1</span> <span class="content">Creating a bucket</span></a>
      <li><a href="#storage-bucket-delete"><span class="secno">1.2</span> <span class="content">Deleting a bucket</span></a>
      <li><a href="#storage-bucket-keys"><span class="secno">1.3</span> <span class="content">Enumerating buckets</span></a>
     </ol>
    <li>
     <a href="#storage-bucket"><span class="secno">2</span> <span class="content">The <code class="idl"><span>StorageBucket</span></code> interface</span></a>
     <ol class="toc">
      <li><a href="#storage-bucket-persistence"><span class="secno">2.1</span> <span class="content">Persistence</span></a>
      <li><a href="#storage-bucket-quota"><span class="secno">2.2</span> <span class="content">Quota</span></a>
      <li><a href="#storage-bucket-durability"><span class="secno">2.3</span> <span class="content">Durability</span></a>
      <li><a href="#storage-bucket-expiration"><span class="secno">2.4</span> <span class="content">Expiration</span></a>
      <li>
       <a href="#storage-bucket-endpoints"><span class="secno">2.5</span> <span class="content">Using storage endpoints</span></a>
       <ol class="toc">
        <li><a href="#storage-bucket-indexeddb"><span class="secno">2.5.1</span> <span class="content">Using Indexed Database</span></a>
        <li><a href="#storage-bucket-caches"><span class="secno">2.5.2</span> <span class="content">Using CacheStorage</span></a>
        <li><a href="#storage-bucket-getdirectory"><span class="secno">2.5.3</span> <span class="content">Using an Origin Private File System</span></a>
       </ol>
      <li><a href="#storage-bucket-clear-site-data"><span class="secno">2.6</span> <span class="content">Clear Site Data integration</span></a>
     </ol>
    <li><a href="#security-privacy"><span class="secno">3</span> <span class="content">Security and privacy considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="storage-bucket-manager"><span class="secno">1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#storagebucketmanager" id="ref-for-storagebucketmanager">StorageBucketManager</a></code> interface</span><a class="self-link" href="#storage-bucket-manager"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="navigatorstoragebuckets"><code><c- g>NavigatorStorageBuckets</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#storagebucketmanager" id="ref-for-storagebucketmanager①"><c- n>StorageBucketManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StorageBucketManager" href="#dom-navigatorstoragebuckets-storagebuckets" id="ref-for-dom-navigatorstoragebuckets-storagebuckets"><c- g>storageBuckets</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstoragebuckets" id="ref-for-navigatorstoragebuckets"><c- n>NavigatorStorageBuckets</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstoragebuckets" id="ref-for-navigatorstoragebuckets①"><c- n>NavigatorStorageBuckets</c-></a>;
</pre>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> has an associated <code class="idl"><a data-link-type="idl" href="#storagebucketmanager" id="ref-for-storagebucketmanager②">StorageBucketManager</a></code> object.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigatorStorageBuckets" data-dfn-type="attribute" data-export id="dom-navigatorstoragebuckets-storagebuckets"><code>storageBuckets</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <code class="idl"><a data-link-type="idl" href="#storagebucketmanager" id="ref-for-storagebucketmanager③">StorageBucketManager</a></code> object.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->),
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="storagebucketmanager"><code><c- g>StorageBucketManager</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#storagebucket" id="ref-for-storagebucket"><c- n>StorageBucket</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucketmanager-open" id="ref-for-dom-storagebucketmanager-open"><c- g>open</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="StorageBucketManager/open(name, options), StorageBucketManager/open(name)" data-dfn-type="argument" data-export id="dom-storagebucketmanager-open-name-options-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-storagebucketmanager-open-name-options-name"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-storagebucketoptions" id="ref-for-dictdef-storagebucketoptions"><c- n>StorageBucketOptions</c-></a> <dfn class="idl-code" data-dfn-for="StorageBucketManager/open(name, options), StorageBucketManager/open(name)" data-dfn-type="argument" data-export id="dom-storagebucketmanager-open-name-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-storagebucketmanager-open-name-options-options"></a></dfn> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-storagebucketmanager-keys" id="ref-for-dom-storagebucketmanager-keys"><c- g>keys</c-></a>();
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucketmanager-delete" id="ref-for-dom-storagebucketmanager-delete"><c- g>delete</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="StorageBucketManager/delete(name)" data-dfn-type="argument" data-export id="dom-storagebucketmanager-delete-name-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-storagebucketmanager-delete-name-name"></a></dfn>);
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-storagebucketdurability"><code><c- g>StorageBucketDurability</c-></code></dfn> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucketDurability" data-dfn-type="enum-value" data-export id="dom-storagebucketdurability-strict"><code><c- s>"strict"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucketDurability" data-dfn-type="enum-value" data-export id="dom-storagebucketdurability-relaxed"><code><c- s>"relaxed"</c-></code></dfn>
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-storagebucketoptions"><code><c- g>StorageBucketOptions</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="StorageBucketOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-storagebucketoptions-persisted"><code><c- g>persisted</c-></code></dfn> = <c- b>false</c->;
  <a data-link-type="idl-name" href="#enumdef-storagebucketdurability" id="ref-for-enumdef-storagebucketdurability"><c- n>StorageBucketDurability</c-></a> <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="StorageBucketOptions" data-dfn-type="dict-member" data-export data-type="StorageBucketDurability " id="dom-storagebucketoptions-durability"><code><c- g>durability</c-></code></dfn> = <c- b>null</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a>? <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="StorageBucketOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long? " id="dom-storagebucketoptions-quota"><code><c- g>quota</c-></code></dfn> = <c- b>null</c->;
  <a data-link-type="idl-name" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp" id="ref-for-dom-domhighrestimestamp"><c- n>DOMHighResTimeStamp</c-></a>? <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="StorageBucketOptions" data-dfn-type="dict-member" data-export data-type="DOMHighResTimeStamp? " id="dom-storagebucketoptions-expires"><code><c- g>expires</c-></code></dfn> = <c- b>null</c->;
};
</pre>
   <h3 class="heading settled" data-level="1.1" id="storage-bucket-open"><span class="secno">1.1. </span><span class="content">Creating a bucket</span><a class="self-link" href="#storage-bucket-open"></a></h3>
   <div class="algorithm" data-algorithm="open(name, options)" data-algorithm-for="StorageBucketManager">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucketManager" data-dfn-type="method" data-export data-lt="open(name, options)|open(name)" id="dom-storagebucketmanager-open"><code>open(<var>name</var>, <var>options</var>)</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf">obtain a local storage shelf</a> given <var>environment</var>.</p>
     <li data-md>
      <p>If <var>shelf</var> is failure, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="#validate-a-bucket-name" id="ref-for-validate-a-bucket-name">validate a bucket name</a> with <var>name</var> is failure,  then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>r</var> be the result of running <a data-link-type="dfn" href="#open-a-bucket" id="ref-for-open-a-bucket">open a bucket</a> with <var>shelf</var>, <var>name</var>, and <var>options</var>.</p>
     <li data-md>
      <p>If <var>r</var> is failure, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with">a promise resolved with</a> with <var>r</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="open a bucket">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="open-a-bucket">open a bucket</dfn> for a <var>shelf</var> given a bucket <var>name</var> and optional <var>options</var>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>expires</var> be undefined.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-expires" id="ref-for-dom-storagebucketoptions-expires">expires</a></code>"] exists, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>expires</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-expires" id="ref-for-dom-storagebucketoptions-expires①">expires</a></code>"].</p>
       <li data-md>
        <p>If <var>expires</var> milliseconds after the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch">Unix epoch</a> is before the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time">current wall time</a>, then return failure.</p>
      </ol>
     <li data-md>
      <p>Let <var>quota</var> be undefined.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-quota" id="ref-for-dom-storagebucketoptions-quota">quota</a></code>"] exists, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>quota</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-quota" id="ref-for-dom-storagebucketoptions-quota①">quota</a></code>"].</p>
       <li data-md>
        <p>If <var>quota</var> is less than or equal to zero, then return failure.</p>
      </ol>
     <li data-md>
      <p>Let <var>persisted</var> be false.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-persisted" id="ref-for-dom-storagebucketoptions-persisted">persisted</a></code>"] is true, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>permission</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-request-permission-to-use" id="ref-for-dfn-request-permission-to-use">requesting permission to use</a> <code>"persistent-storage"</code>.</p>
       <li data-md>
        <p>If <var>permission</var> is "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-granted" id="ref-for-dom-permissionstate-granted">granted</a></code>", then set <var>persisted</var> to true.</p>
      </ol>
     <li data-md>
      <p>Let <var>bucket</var> be the result of running <a data-link-type="dfn" href="#get-or-expire-a-bucket" id="ref-for-get-or-expire-a-bucket">get or expire a bucket</a> with <var>shelf</var> and <var>name</var>.</p>
     <li data-md>
      <p>If <var>bucket</var> is null, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>bucket</var> be a new <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket">storage bucket</a> with name <var>name</var>.</p>
       <li data-md>
        <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value">durability value</a> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-durability" id="ref-for-dom-storagebucketoptions-durability">durability</a></code>"] if it exists.</p>
       <li data-md>
        <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-quota-value" id="ref-for-storagebucket-quota-value">quota value</a> to <var>quota</var>.</p>
       <li data-md>
        <p>Set <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map">bucket map</a>[<var>name</var>] to <var>bucket</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>persisted</var> is true, set <var>bucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode">bucket mode</a> to <code>"persistent"</code>.</p>
     <li data-md>
      <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-expiration-time" id="ref-for-storagebucket-expiration-time">expiration</a> to <var>expires</var> milliseconds after the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch①">Unix epoch</a>.</p>
     <li data-md>
      <p>Let <var>storageBucket</var> be a new <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket①">StorageBucket</a></code>.</p>
     <li data-md>
      <p>Set <var>storageBucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①">storage bucket</a> to <var>bucket</var>.</p>
     <li data-md>
      <p>Return <var>storageBucket</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="validate a bucket name">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="validate-a-bucket-name">validate a bucket name</dfn> given string <var>name</var>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>name</var> contains any <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-point" id="ref-for-code-point">code point</a> that is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-lower-alpha" id="ref-for-ascii-lower-alpha">ASCII lower alpha</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-digit" id="ref-for-ascii-digit">ASCII digit</a>, U+005F (_), or U+002D(-), then return failure.</p>
     <li data-md>
      <p>If <var>name</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-code-point-length" id="ref-for-string-code-point-length">code point length</a> is 0 or exceeds 64, then return failure.</p>
     <li data-md>
      <p>If <var>name</var> begins with U+005F (_) or U+002D(-), then return failure.</p>
     <li data-md>
      <p>Return.</p>
    </ol>
   </div>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-or-expire-a-bucket">get or expire a bucket</dfn> on a <var>shelf</var> given string <var>name</var>, run the following steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>bucket</var> be <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map①">bucket map</a>[<var>name</var>] if exists. Otherwise return null.</p>
    <li data-md>
     <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-expiration-time" id="ref-for-storagebucket-expiration-time①">expiration time</a> is non-null and before the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time①">current wall time</a>, then:</p>
     <ol>
      <li data-md>
       <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed">removed</a> to true.</p>
      <li data-md>
       <p>Return null.</p>
     </ol>
    <li data-md>
     <p>Return <var>bucket</var>.</p>
   </ol>
   <p>When not null or undefined, <code class="idl"><a data-link-type="idl" href="#dom-storagebucketoptions-durability" id="ref-for-dom-storagebucketoptions-durability①">durability</a></code> is a hint to the user agent
specifying the desired <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-durability" id="ref-for-dom-storagebucket-durability">durability</a></code>. The user agent MAY
create a new <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket②">StorageBucket</a></code> with this <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value①">durability value</a>. The user agent
MUST NOT modify the <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value②">durability value</a> of an existing bucket.</p>
   <h3 class="heading settled" data-level="1.2" id="storage-bucket-delete"><span class="secno">1.2. </span><span class="content">Deleting a bucket</span><a class="self-link" href="#storage-bucket-delete"></a></h3>
   <div class="algorithm" data-algorithm="delete(name)" data-algorithm-for="StorageBucketManager">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucketManager" data-dfn-type="method" data-export id="dom-storagebucketmanager-delete"><code>delete(<var>name</var>)</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf①">obtain a local storage shelf</a> given <var>environment</var>.</p>
     <li data-md>
      <p>If <var>shelf</var> is failure, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with③">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If the result of <a data-link-type="dfn" href="#validate-a-bucket-name" id="ref-for-validate-a-bucket-name①">validate a bucket name</a> with <var>name</var> is failure, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>p</var> with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidcharactererror" id="ref-for-invalidcharactererror">InvalidCharacterError</a></code> and abort these steps.</p>
       <li data-md>
        <p>Let <var>r</var> be the result of running <a data-link-type="dfn" href="#remove-a-bucket" id="ref-for-remove-a-bucket">remove a bucket</a> with <var>shelf</var> and <var>name</var>.</p>
       <li data-md>
        <p>If <var>r</var> is failure, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">reject</a> <var>p</var> with <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">resolve</a> <var>p</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="remove a bucket">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remove-a-bucket">remove a bucket</dfn> on a <var>shelf</var> given a bucket <var>name</var>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>bucket</var> be <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map②">bucket map</a>[<var>name</var>] if exists. Otherwise return.</p>
     <li data-md>
      <p>Remove <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">key</a> <var>name</var> in <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map③">bucket map</a>.</p>
     <li data-md>
      <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed①">removed</a> to true.</p>
     <li data-md>
      <p>Return.</p>
    </ol>
    <aside class="note">
     <p>Specific storage endpoints may need to run additional actions to remove data when a storage bucket is set as removed.</p>
    </aside>
    <p class="issue" id="issue-4958726d"><a class="self-link" href="#issue-4958726d"></a> <a data-link-type="biblio" href="#biblio-indexeddb-3" title="Indexed Database API 3.0">[IndexedDB-3]</a> needs to define how deletion occurs when data is evicted by quota.</p>
    <p class="issue" id="issue-c5f1de1a"><a class="self-link" href="#issue-c5f1de1a"></a> <a data-link-type="biblio" href="#biblio-fs" title="File System Standard">[FS]</a> needs to define how deletion occurs for Origin Private File System when data is evicted by quota.</p>
    <p class="issue" id="issue-2e7a487e"><a class="self-link" href="#issue-2e7a487e"></a> <a data-link-type="biblio" href="#biblio-service-workers" title="Service Workers">[Service-Workers]</a> needs to define how deletion occurs for CacheStorage and Service Workers when data is evicted by quota.</p>
   </div>
   <h3 class="heading settled" data-level="1.3" id="storage-bucket-keys"><span class="secno">1.3. </span><span class="content">Enumerating buckets</span><a class="self-link" href="#storage-bucket-keys"></a></h3>
   <div class="algorithm" data-algorithm="keys()" data-algorithm-for="StorageBucketManager">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucketManager" data-dfn-type="method" data-export id="dom-storagebucketmanager-keys"><code>keys()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf②">obtain a local storage shelf</a>.</p>
     <li data-md>
      <p>If <var>shelf</var> is failure, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with④">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑤">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise①">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>keys</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a>.</p>
     <li data-md>
      <p>For each <var>key</var> in <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map④">bucket map</a>, run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>bucket</var> be the result of running <a data-link-type="dfn" href="#get-or-expire-a-bucket" id="ref-for-get-or-expire-a-bucket①">get or expire a bucket</a> with <var>shelf</var> and <var>key</var>.</p>
       <li data-md>
        <p>If <var>bucket</var> is non-null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">append</a> <var>key</var> to <var>keys</var>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task">Queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve①">resolve</a> <var>p</var> with <var>keys</var>.</p>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="2" id="storage-bucket"><span class="secno">2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket③">StorageBucket</a></code> interface</span><a class="self-link" href="#storage-bucket"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->),
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext②"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="storagebucket"><code><c- g>StorageBucket</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-storagebucket-name" id="ref-for-dom-storagebucket-name"><c- g>name</c-></a>;

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-persist" id="ref-for-dom-storagebucket-persist"><c- g>persist</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise④"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean②"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-persisted" id="ref-for-dom-storagebucket-persisted"><c- g>persisted</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑤"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://storage.spec.whatwg.org/#dictdef-storageestimate" id="ref-for-dictdef-storageestimate"><c- n>StorageEstimate</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-estimate" id="ref-for-dom-storagebucket-estimate"><c- g>estimate</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑥"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#enumdef-storagebucketdurability" id="ref-for-enumdef-storagebucketdurability①"><c- n>StorageBucketDurability</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-durability" id="ref-for-dom-storagebucket-durability①"><c- g>durability</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑦"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-setexpires" id="ref-for-dom-storagebucket-setexpires"><c- g>setExpires</c-></a>(<a data-link-type="idl-name" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp" id="ref-for-dom-domhighrestimestamp①"><c- n>DOMHighResTimeStamp</c-></a> <dfn class="idl-code" data-dfn-for="StorageBucket/setExpires(expires)" data-dfn-type="argument" data-export id="dom-storagebucket-setexpires-expires-expires"><code><c- g>expires</c-></code><a class="self-link" href="#dom-storagebucket-setexpires-expires-expires"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑧"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp" id="ref-for-dom-domhighrestimestamp②"><c- n>DOMHighResTimeStamp</c-></a>?> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-expires" id="ref-for-dom-storagebucket-expires"><c- g>expires</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject①"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory"><c- n>IDBFactory</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="IDBFactory" href="#dom-storagebucket-indexeddb" id="ref-for-dom-storagebucket-indexeddb"><c- g>indexedDB</c-></a>;

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject②"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#cachestorage" id="ref-for-cachestorage"><c- n>CacheStorage</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="CacheStorage" href="#dom-storagebucket-caches" id="ref-for-dom-storagebucket-caches"><c- g>caches</c-></a>;

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑨"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://fs.spec.whatwg.org/#filesystemdirectoryhandle" id="ref-for-filesystemdirectoryhandle"><c- n>FileSystemDirectoryHandle</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-getdirectory" id="ref-for-dom-storagebucket-getdirectory"><c- g>getDirectory</c-></a>();
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket④">StorageBucket</a></code> has an associated <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket②">storage bucket</a>.</p>
   <p>A <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket③">storage bucket</a> has an associated <dfn class="dfn-paneled" data-dfn-for="storage bucket" data-dfn-type="dfn" data-noexport id="storage-bucket-removed">removed</dfn> flag, which is a boolean, initially false. Set as true when a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket④">storage bucket</a> is deleted.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket⑤">StorageBucket</a></code> has a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④">DOMString</a></code> object <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="attribute" data-export id="dom-storagebucket-name"><code>name</code></dfn> which is the key in the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map⑤">bucket map</a> that maps to the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket⑤">storage bucket</a>.</p>
   <aside class="note">
    <p>Browsers will probably have IPC and disk accesses that make operations asynchronous. Promises are resolved from tasks to permit this kind of work.</p>
   </aside>
   <h3 class="heading settled" data-level="2.1" id="storage-bucket-persistence"><span class="secno">2.1. </span><span class="content">Persistence</span><a class="self-link" href="#storage-bucket-persistence"></a></h3>
   <p class="issue" id="issue-3271f8e6"><a class="self-link" href="#issue-3271f8e6"></a> Merge with <a href="https://storage.spec.whatwg.org/#buckets"><cite>Storage</cite> § 4.5 Storage buckets</a> which already defines <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode①">bucket mode</a>.</p>
   <div class="algorithm" data-algorithm="persist()" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-persist"><code>persist()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket⑥">storage bucket</a>.</p>
     <li data-md>
      <p>Let <var>environment</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑤">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise②">a new promise</a>.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed②">removed</a> flag is true, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject②">reject</a> <var>p</var> with <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>.</p>
       <li data-md>
        <p>If <var>bucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode②">bucket mode</a> is <code>"persistent"</code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve②">resolve</a> <var>p</var> with true.</p>
       <li data-md>
        <p>Otherwise,</p>
        <ol>
         <li data-md>
          <p>Let <var>permission</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state" id="ref-for-dfn-getting-the-current-permission-state">getting the current permission state</a> with <code>"persistent-storage"</code> and <var>environment</var>.</p>
         <li data-md>
          <p>If <var>permission</var> is "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-granted" id="ref-for-dom-permissionstate-granted①">granted</a></code>", then set <var>bucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode③">bucket mode</a> to <code>"persistent"</code> and <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task①">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve③">resolve</a> <var>p</var> with true.</p>
         <li data-md>
          <p>Otherwise, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve④">resolve</a> <var>p</var> with false.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="persisted()" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-persisted"><code>persisted()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise③">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket⑦">storage bucket</a>.</p>
     <li data-md>
      <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed③">removed</a> flag is true, then <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task②">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject③">reject</a> <var>p</var> with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>.</p>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>If <var>bucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode④">bucket mode</a> is <code>"persistent"</code>, then <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task③">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑤">resolve</a> <var>p</var> with true.</p>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task④">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑥">resolve</a> <var>p</var> with false.</p>
      </ol>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="2.2" id="storage-bucket-quota"><span class="secno">2.2. </span><span class="content">Quota</span><a class="self-link" href="#storage-bucket-quota"></a></h3>
   <p>A <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket⑧">storage bucket</a> has a <dfn class="dfn-paneled" data-dfn-for="StorageBucket" data-dfn-type="dfn" data-noexport id="storagebucket-quota-value">quota value</dfn>, a number-or-null, initially null.
Specifies the upper limit of usage in bytes which can be used by the bucket. The user agent MAY further
limit the realized storage space.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-for="storage bucket" data-dfn-type="dfn" data-noexport id="storage-bucket-storage-usage">storage usage</dfn> of a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket⑨">storage bucket</a> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> rough estimate
of the number of bytes used by all of its <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle" id="ref-for-storage-bottle">storage bottle</a>s.</p>
   <div class="algorithm" data-algorithm="estimate()" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-estimate"><code>estimate()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑥">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf③">obtain a local storage shelf</a> with <var>environment</var>.</p>
     <li data-md>
      <p>If <var>shelf</var> is failure, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑤">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑥">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①⓪">storage bucket</a>.</p>
     <li data-md>
      <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed④">removed</a> flag is true, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑥">a promise rejected with</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>.</p>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise④">a new promise</a>.</p>
     <li data-md>
      <p>Otherwise, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>quota</var> be <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-quota" id="ref-for-storage-quota">storage quota</a> for <var>shelf</var>.</p>
       <li data-md>
        <p>Set <var>quota</var> to <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-quota-value" id="ref-for-storagebucket-quota-value①">quota value</a> if it is non-null.</p>
       <li data-md>
        <p>Let <var>usage</var> be <a data-link-type="dfn" href="#storage-bucket-storage-usage" id="ref-for-storage-bucket-storage-usage">storage usage</a> for <var>bucket</var>.</p>
       <li data-md>
        <p>Let <var>dictionary</var> be a new <code class="idl"><a data-link-type="idl" href="https://storage.spec.whatwg.org/#dictdef-storageestimate" id="ref-for-dictdef-storageestimate①">StorageEstimate</a></code> dictionary whose <code class="idl"><a data-link-type="idl" href="https://storage.spec.whatwg.org/#dom-storageestimate-usage" id="ref-for-dom-storageestimate-usage">usage</a></code> member is <var>usage</var> and <code class="idl"><a data-link-type="idl" href="https://storage.spec.whatwg.org/#dom-storageestimate-quota" id="ref-for-dom-storageestimate-quota">quota</a></code> member is <var>quota</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑦">Resolve</a> <var>p</var> with <var>dictionary</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <aside class="note">
    <p>The <a data-link-type="dfn" href="#storagebucket-quota-value" id="ref-for-storagebucket-quota-value②">quota value</a> will be ignored if it exceeds the total amount of space available to the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shelf" id="ref-for-storage-shelf">storage shelf</a>, i.e. site.
Its intended use is to keep a specific bucket from using up the entire site’s storage space.</p>
   </aside>
   <h3 class="heading settled" data-level="2.3" id="storage-bucket-durability"><span class="secno">2.3. </span><span class="content">Durability</span><a class="self-link" href="#storage-bucket-durability"></a></h3>
   <p>A <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①①">storage bucket</a> has a <dfn class="dfn-paneled" data-dfn-for="StorageBucket" data-dfn-type="dfn" data-noexport id="storagebucket-durability-value">durability value</dfn>, a <code class="idl"><a data-link-type="idl" href="#enumdef-storagebucketdurability" id="ref-for-enumdef-storagebucketdurability②">StorageBucketDurability</a></code>.
The user agent MAY initialize this value to "<code class="idl"><a data-link-type="idl" href="#dom-storagebucketdurability-strict" id="ref-for-dom-storagebucketdurability-strict">strict</a></code>" or
"<code class="idl"><a data-link-type="idl" href="#dom-storagebucketdurability-relaxed" id="ref-for-dom-storagebucketdurability-relaxed">relaxed</a></code>". The user agent SHOULD ignore the <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value③">durability value</a> for operations that otherwise specify durability behavior.</p>
   <div class="algorithm" data-algorithm="durability()" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-durability"><code>durability()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise⑤">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑧">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①②">storage bucket</a>.</p>
     <li data-md>
      <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed⑤">removed</a> flag is true, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task⑤">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject④">reject</a> <var>p</var> with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code>.</p>
     <li data-md>
      <p>Otherwise, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task⑥">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑧">resolve</a> <var>p</var> with <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value④">durability value</a>.</p>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <aside class="note">
    <p>The durability reflects whether the user agent will prioritize performance or durability when completing operations on data in the bucket.
Some operations, such as <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbtransaction" id="ref-for-idbtransaction">IDBTransaction</a></code>s, can specify a durability which will override the <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value⑤">durability value</a>. The default <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value⑥">durability value</a> is left to the user agent. Durability can be specified when a bucket is initially created, but not changed later.
The <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-durability" id="ref-for-dom-storagebucket-durability②">durability()</a></code> method should report what the user agent will actually do. The value is one of the following:</p>
    <dl>
     <dt data-md>"<code class="idl"><a data-link-type="idl" href="#dom-storagebucketdurability-strict" id="ref-for-dom-storagebucketdurability-strict①">strict</a></code>"
     <dd data-md>
      <p>The user agent will consider that operations on data in the bucket are successful only after verifying that outstanding changes have been written to a persistent storage medium.</p>
     <dt data-md>"<code class="idl"><a data-link-type="idl" href="#dom-storagebucketdurability-relaxed" id="ref-for-dom-storagebucketdurability-relaxed①">relaxed</a></code>"
     <dd data-md>
      <p>The user agent will consider that operations on data in the bucket are successful as soon as all outstanding changes have been written to the operating system, without subsequent verification.</p>
    </dl>
   </aside>
   <h3 class="heading settled" data-level="2.4" id="storage-bucket-expiration"><span class="secno">2.4. </span><span class="content">Expiration</span><a class="self-link" href="#storage-bucket-expiration"></a></h3>
   <p>A <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①③">storage bucket</a> has an <dfn class="dfn-paneled" data-dfn-for="StorageBucket" data-dfn-type="dfn" data-noexport id="storagebucket-expiration-time">expiration time</dfn>, which is either null or a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment">moment</a> on the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock">wall clock</a>, initially null.
Specifies the upper limit of a bucket lifetime.</p>
   <p>The <a data-link-type="dfn" href="#get-or-expire-a-bucket" id="ref-for-get-or-expire-a-bucket②">get or expire a bucket</a> algorithm removes expired buckets when <code class="idl"><a data-link-type="idl" href="#dom-storagebucketmanager-keys" id="ref-for-dom-storagebucketmanager-keys①">keys()</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-storagebucketmanager-open" id="ref-for-dom-storagebucketmanager-open①">open()</a></code> is called.
User agents MAY clear buckets whose <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode⑤">bucket mode</a> is <code>"best-effort"</code> before their <a data-link-type="dfn" href="#storagebucket-expiration-time" id="ref-for-storagebucket-expiration-time②">expiration time</a> when faced with storage pressure.
User agents MAY remove any buckets before <code class="idl"><a data-link-type="idl" href="#dom-storagebucketmanager-open" id="ref-for-dom-storagebucketmanager-open②">open()</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-storagebucketmanager-keys" id="ref-for-dom-storagebucketmanager-keys②">keys()</a></code> is called when the expiration is reached regardless of the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode" id="ref-for-bucket-mode⑥">bucket mode</a></p>
   <div class="algorithm" data-algorithm="setExpires(expires)" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-setexpires"><code>setExpires(<var>expires</var>)</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise⑥">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①④">storage bucket</a>.</p>
     <li data-md>
      <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed⑥">removed</a> flag is true, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task⑦">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑤">reject</a> <var>p</var> with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code>.</p>
     <li data-md>
      <p>Otherwise, set <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-expiration-time" id="ref-for-storagebucket-expiration-time③">expiration time</a> to <var>expires</var> milliseconds after the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch②">Unix epoch</a> and <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task⑧">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑨">resolve</a> <var>p</var>.</p>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="expires()" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-expires"><code>expires()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise⑦">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⓪">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①⑤">storage bucket</a>.</p>
     <li data-md>
      <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storage-bucket-removed" id="ref-for-storage-bucket-removed⑦">removed</a> flag is true, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task⑨">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑥">reject</a> <var>p</var> with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror⑤">InvalidStateError</a></code>.</p>
     <li data-md>
      <p>Otherwise, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#queue-a-storage-task" id="ref-for-queue-a-storage-task①⓪">queue a storage task</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve①⓪">resolve</a> <var>p</var> with <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-expiration-time" id="ref-for-storagebucket-expiration-time④">expiration time</a>.</p>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="2.5" id="storage-bucket-endpoints"><span class="secno">2.5. </span><span class="content">Using storage endpoints</span><a class="self-link" href="#storage-bucket-endpoints"></a></h3>
   <p>Storage endpoints, i.e. storage bottles, can be accessed as described below.</p>
   <h4 class="heading settled" data-level="2.5.1" id="storage-bucket-indexeddb"><span class="secno">2.5.1. </span><span class="content">Using Indexed Database</span><a class="self-link" href="#storage-bucket-indexeddb"></a></h4>
   <p class="issue" id="issue-4f9abb58"><a class="self-link" href="#issue-4f9abb58"></a> <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory①">IDBFactory</a></code> methods need to take a storage bottle map rather than a storageKey.</p>
   <div class="algorithm" data-algorithm="indexedDB" data-algorithm-for="StorageBucket">
    <p>A <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket⑥">StorageBucket</a></code> has an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory②">IDBFactory</a></code> object, initially null. The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="attribute" data-export id="dom-storagebucket-indexeddb"><code>indexedDB</code></dfn> getter steps are:</p>
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①①">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-indexeddb" id="ref-for-dom-storagebucket-indexeddb①">indexedDB</a></code> is null, run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①②">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①⑥">storage bucket</a>.</p>
       <li data-md>
        <p>Let <var>bottle map</var> be the result of <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map" id="ref-for-obtain-a-local-storage-bottle-map">obtain a local storage bottle map</a> with <var>bucket</var> and <code>"indexedDB"</code>.</p>
       <li data-md>
        <p>Let <var>indexedDB</var> be an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory③">IDBFactory</a></code> object.</p>
       <li data-md>
        <p>Set the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle-map" id="ref-for-storage-bottle-map">storage bottle map</a> for <var>indexedDB</var> to <var>bottle map</var>.</p>
       <li data-md>
        <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①③">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-indexeddb" id="ref-for-dom-storagebucket-indexeddb②">indexedDB</a></code> to <var>indexedDB</var>.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①④">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-indexeddb" id="ref-for-dom-storagebucket-indexeddb③">indexedDB</a></code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="calculate the effective durability hint">
    <p>The user agent MUST consider the <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value⑦">durability value</a> when evaluating the <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-durability-hint" id="ref-for-transaction-durability-hint">durability hint</a> <var>durability</var> of an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbtransaction" id="ref-for-idbtransaction①">IDBTransaction</a></code> <var>transaction</var>. To <dfn data-dfn-type="dfn" data-noexport id="calculate-the-effective-durability-hint">calculate the effective <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-durability-hint" id="ref-for-transaction-durability-hint①">durability hint</a><a class="self-link" href="#calculate-the-effective-durability-hint"></a></dfn> for <var>transaction</var> with associated <var>bucket</var>:</p>
    <ol>
     <li data-md>
      <p>If <var>durability</var> is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbtransactiondurability-default" id="ref-for-dom-idbtransactiondurability-default">default</a></code>", then return <var>durability</var>.</p>
     <li data-md>
      <p>If <var>bucket</var>’s <a data-link-type="dfn" href="#storagebucket-durability-value" id="ref-for-storagebucket-durability-value⑧">durability value</a> is "<code class="idl"><a data-link-type="idl" href="#dom-storagebucketdurability-strict" id="ref-for-dom-storagebucketdurability-strict②">strict</a></code>", then return "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbtransactiondurability-strict" id="ref-for-dom-idbtransactiondurability-strict">strict</a></code>".</p>
     <li data-md>
      <p>Return "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbtransactiondurability-relaxed" id="ref-for-dom-idbtransactiondurability-relaxed">relaxed</a></code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.5.2" id="storage-bucket-caches"><span class="secno">2.5.2. </span><span class="content">Using CacheStorage</span><a class="self-link" href="#storage-bucket-caches"></a></h4>
   <div class="algorithm" data-algorithm="caches" data-algorithm-for="StorageBucket">
    <p>A <code class="idl"><a data-link-type="idl" href="#storagebucket" id="ref-for-storagebucket⑦">StorageBucket</a></code> has a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#cachestorage" id="ref-for-cachestorage①">CacheStorage</a></code> object, initially null. The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="attribute" data-export id="dom-storagebucket-caches"><code>caches</code></dfn> getter steps are:</p>
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑤">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-caches" id="ref-for-dom-storagebucket-caches①">caches</a></code> is null, run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>bucket</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑥">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①⑦">storage bucket</a>.</p>
       <li data-md>
        <p>Let <var>bottle map</var> be the result of <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map" id="ref-for-obtain-a-local-storage-bottle-map①">obtain a local storage bottle map</a> with <var>bucket</var> and <code>"cacheStorage"</code>.</p>
       <li data-md>
        <p>Let <var>cacheStorage</var> be a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#cachestorage" id="ref-for-cachestorage②">CacheStorage</a></code> object.</p>
       <li data-md>
        <p>Set the <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map">relevant name to cache map</a> for <var>cacheStorage</var> to <var>bottle map</var>.</p>
       <li data-md>
        <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑦">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-caches" id="ref-for-dom-storagebucket-caches②">caches</a></code> to <var>cacheStorage</var>.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑧">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-storagebucket-caches" id="ref-for-dom-storagebucket-caches③">caches</a></code>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.5.3" id="storage-bucket-getdirectory"><span class="secno">2.5.3. </span><span class="content">Using an Origin Private File System</span><a class="self-link" href="#storage-bucket-getdirectory"></a></h4>
   <p class="issue" id="issue-0d9f1d43"><a class="self-link" href="#issue-0d9f1d43"></a> <a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[Storage]</a> needs to define helpers to retrieve the bottle map for a given (non-default) bucket.</p>
   <p class="issue" id="issue-25ffaa8c"><a class="self-link" href="#issue-25ffaa8c"></a> <a data-link-type="biblio" href="#biblio-fs" title="File System Standard">[FS]</a> needs to define a helper to retrieve an OPFS given a bottle map.</p>
   <div class="algorithm" data-algorithm="getDirectory()" data-algorithm-for="StorageBucket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageBucket" data-dfn-type="method" data-export id="dom-storagebucket-getdirectory"><code>getDirectory()</code></dfn> steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>map</var> be the result of <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map" id="ref-for-obtain-a-local-storage-bottle-map②">obtain a local storage bottle map</a> with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑨">this</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①⑧">storage bucket</a> and <code>"fileSystem"</code>.</p>
     <li data-md>
      <p>Return the result of <code class="idl"><a data-link-type="idl" href="https://fs.spec.whatwg.org/#dom-storagemanager-getdirectory" id="ref-for-dom-storagemanager-getdirectory">getDirectory</a></code> with <var>map</var>.</p>
    </ol>
   </div>
   <aside class="note">
    <p>See <a href="https://fs.spec.whatwg.org/#sandboxed-filesystem"><cite>File System</cite> § 3 Accessing the Bucket File System</a>.</p>
   </aside>
   <h3 class="heading settled" data-level="2.6" id="storage-bucket-clear-site-data"><span class="secno">2.6. </span><span class="content">Clear Site Data integration</span><a class="self-link" href="#storage-bucket-clear-site-data"></a></h3>
   <p class="issue" id="issue-99cfd987"><a class="self-link" href="#issue-99cfd987"></a> Update <a href="https://w3c.github.io/webappsec-clear-site-data/#header"><cite>Clear Site Data</cite> § 3.1 The Clear-Site-Data HTTP Response Header Field</a>.</p>
   <dl>
    <dt data-md>"<dfn data-dfn-type="grammar" data-export id="grammardef-storagebucket-name"><code>storage:bucket-name</code><a class="self-link" href="#grammardef-storagebucket-name"></a></dfn>"
    <dd data-md>
     <p>If the type string starts with "<code>storage:</code>" then the remaining characters after the <code>:</code> will be taken to refer to a specific <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①⑨">storage bucket</a> in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a> of a
  particular response’s URL.</p>
   </dl>
   <p class="issue" id="issue-99223a67"><a class="self-link" href="#issue-99223a67"></a> add the steps below to the algorithm in <a href="https://w3c.github.io/webappsec-clear-site-data/#parsing"><cite>Clear Site Data</cite> § 4.1 Parsing</a>.</p>
   <div class="algorithm" data-algorithm="parse a Clear-Site-Data header with buckets">
    <p>To <dfn data-dfn-type="dfn" data-noexport id="parse-a-clear-site-data-header-with-buckets">parse a Clear-Site-Data header with buckets<a class="self-link" href="#parse-a-clear-site-data-header-with-buckets"></a></dfn>, execute the following steps:</p>
    <ol>
     <li data-md>
      <p>For each <var>type</var> in <var>header</var>, execute the following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>type</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-starts-with" id="ref-for-string-starts-with">start with</a> <code>"storage:"</code>, abort these steps.</p>
       <li data-md>
        <p>Let <var>bucket name</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-unit-substring-by-positions" id="ref-for-code-unit-substring-by-positions">code unit substring</a> from 8 to end of <var>type</var>.</p>
       <li data-md>
        <p>If the result of <a data-link-type="dfn" href="#validate-a-bucket-name" id="ref-for-validate-a-bucket-name②">validate a bucket name</a> with <var>bucket name</var> is failure, then abort these steps.</p>
       <li data-md>
        <p>Append a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> consisting of (<code>"storage-bucket"</code>, <var>bucket name</var>) to <var>types</var></p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-99223a67①"><a class="self-link" href="#issue-99223a67①"></a> add the steps below to the algorithm in <a href="https://w3c.github.io/webappsec-clear-site-data/#clear-response"><cite>Clear Site Data</cite> § 4.2 Clear data for response</a>.</p>
   <div class="algorithm" data-algorithm="clear data with buckets">
    <p>To <dfn data-dfn-type="dfn" data-noexport id="clear-data-with-buckets">clear data with buckets<a class="self-link" href="#clear-data-with-buckets"></a></dfn> given a <var>bucket name</var>, execute the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⓪">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑦">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf④">obtain a local storage shelf</a> given <var>environment</var>.</p>
     <li data-md>
      <p>If <var>shelf</var> is failure, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑦">TypeError</a></code> and abort these steps.</p>
     <li data-md>
      <p>For each <var>type</var> in <var>types</var>, execute the following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>type</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuple</a> or <var>type</var>[0] is not <code>"storage-bucket"</code>, abort these steps.</p>
       <li data-md>
        <p>Let <var>bucket</var> be <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map⑥">bucket map</a>[<var>bucket name</var>] if one exists. Otherwise abort these steps</p>
       <li data-md>
        <p>Remove <var>bucket</var>.</p>
      </ol>
    </ol>
   </div>
   <h2 class="heading settled" data-level="3" id="security-privacy"><span class="secno">3. </span><span class="content">Security and privacy considerations</span><a class="self-link" href="#security-privacy"></a></h2>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-storagebucket-caches">caches</a><span>, in § 2.5.2</span>
   <li><a href="#calculate-the-effective-durability-hint">calculate the effective durability hint</a><span>, in § 2.5.1</span>
   <li><a href="#clear-data-with-buckets">clear data with buckets</a><span>, in § 2.6</span>
   <li><a href="#dom-storagebucketmanager-delete">delete(name)</a><span>, in § 1.2</span>
   <li><a href="#dom-storagebucketoptions-durability">durability</a><span>, in § 1</span>
   <li><a href="#dom-storagebucket-durability">durability()</a><span>, in § 2.3</span>
   <li><a href="#storagebucket-durability-value">durability value</a><span>, in § 2.3</span>
   <li><a href="#dom-storagebucket-estimate">estimate()</a><span>, in § 2.2</span>
   <li><a href="#storagebucket-expiration-time">expiration time</a><span>, in § 2.4</span>
   <li><a href="#dom-storagebucketoptions-expires">expires</a><span>, in § 1</span>
   <li><a href="#dom-storagebucket-expires">expires()</a><span>, in § 2.4</span>
   <li><a href="#dom-storagebucket-getdirectory">getDirectory()</a><span>, in § 2.5.3</span>
   <li><a href="#get-or-expire-a-bucket">get or expire a bucket</a><span>, in § 1.1</span>
   <li><a href="#dom-storagebucket-indexeddb">indexedDB</a><span>, in § 2.5.1</span>
   <li><a href="#dom-storagebucketmanager-keys">keys()</a><span>, in § 1.3</span>
   <li><a href="#dom-storagebucket-name">name</a><span>, in § 2</span>
   <li><a href="#navigatorstoragebuckets">NavigatorStorageBuckets</a><span>, in § 1</span>
   <li><a href="#open-a-bucket">open a bucket</a><span>, in § 1.1</span>
   <li><a href="#dom-storagebucketmanager-open">open(name)</a><span>, in § 1.1</span>
   <li><a href="#dom-storagebucketmanager-open">open(name, options)</a><span>, in § 1.1</span>
   <li><a href="#parse-a-clear-site-data-header-with-buckets">parse a Clear-Site-Data header with buckets</a><span>, in § 2.6</span>
   <li><a href="#dom-storagebucket-persist">persist()</a><span>, in § 2.1</span>
   <li><a href="#dom-storagebucketoptions-persisted">persisted</a><span>, in § 1</span>
   <li><a href="#dom-storagebucket-persisted">persisted()</a><span>, in § 2.1</span>
   <li><a href="#dom-storagebucketoptions-quota">quota</a><span>, in § 1</span>
   <li><a href="#storagebucket-quota-value">quota value</a><span>, in § 2.2</span>
   <li><a href="#dom-storagebucketdurability-relaxed">"relaxed"</a><span>, in § 1</span>
   <li><a href="#remove-a-bucket">remove a bucket</a><span>, in § 1.2</span>
   <li><a href="#storage-bucket-removed">removed</a><span>, in § 2</span>
   <li><a href="#dom-storagebucket-setexpires">setExpires(expires)</a><span>, in § 2.4</span>
   <li><a href="#storagebucket">StorageBucket</a><span>, in § 2</span>
   <li><a href="#enumdef-storagebucketdurability">StorageBucketDurability</a><span>, in § 1</span>
   <li><a href="#storagebucketmanager">StorageBucketManager</a><span>, in § 1</span>
   <li><a href="#grammardef-storagebucket-name">storage:bucket-name</a><span>, in § 2.6</span>
   <li><a href="#dictdef-storagebucketoptions">StorageBucketOptions</a><span>, in § 1</span>
   <li><a href="#dom-navigatorstoragebuckets-storagebuckets">storageBuckets</a><span>, in § 1</span>
   <li><a href="#storage-bucket-storage-usage">storage usage</a><span>, in § 2.2</span>
   <li><a href="#dom-storagebucketdurability-strict">"strict"</a><span>, in § 1</span>
   <li><a href="#validate-a-bucket-name">validate a bucket name</a><span>, in § 1.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[FS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="23e108bd">FileSystemDirectoryHandle</span>
     <li><span class="dfn-paneled" id="4c10050a">getDirectory()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0e9f636b">DOMHighResTimeStamp</span>
     <li><span class="dfn-paneled" id="f16ee824">current wall time</span>
     <li><span class="dfn-paneled" id="1e2edd5b">moment</span>
     <li><span class="dfn-paneled" id="be5dbc8c">unix epoch</span>
     <li><span class="dfn-paneled" id="05de5ae3">wall clock</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="be0c27b2">Navigator</span>
     <li><span class="dfn-paneled" id="a4785085">WorkerNavigator</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="43ac8374">origin</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
    </ul>
   <li>
    <a data-link-type="biblio">[IndexedDB-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7ca1d370">"default"</span>
     <li><span class="dfn-paneled" id="e86b5ce4">"relaxed"</span>
     <li><span class="dfn-paneled" id="5fd5f41c">"strict"</span>
     <li><span class="dfn-paneled" id="78f41bd1">IDBFactory</span>
     <li><span class="dfn-paneled" id="668bd53e">IDBTransaction</span>
     <li><span class="dfn-paneled" id="a5cbd966">durability hint</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append</span>
     <li><span class="dfn-paneled" id="3b38c2fe">ascii digit</span>
     <li><span class="dfn-paneled" id="5661d95e">ascii lower alpha</span>
     <li><span class="dfn-paneled" id="915aff5e">code point</span>
     <li><span class="dfn-paneled" id="4ef39030">code point length</span>
     <li><span class="dfn-paneled" id="b8958cfc">code unit substring by positions</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="d14a6f26">key</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="54627f47">starts with</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="33438879">getting the current permission state</span>
     <li><span class="dfn-paneled" id="c6ce3c60">granted</span>
     <li><span class="dfn-paneled" id="d357c753">requesting permission to use</span>
    </ul>
   <li>
    <a data-link-type="biblio">[Service-Workers]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f747b195">CacheStorage</span>
     <li><span class="dfn-paneled" id="e7e8a4f7">relevant name to cache map</span>
    </ul>
   <li>
    <a data-link-type="biblio">[Storage]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="48a84355">StorageEstimate</span>
     <li><span class="dfn-paneled" id="7db4a4b7">bucket map</span>
     <li><span class="dfn-paneled" id="b9712e0a">bucket mode</span>
     <li><span class="dfn-paneled" id="6bb9d790">obtain a local storage bottle map</span>
     <li><span class="dfn-paneled" id="caa5107f">obtain a local storage shelf</span>
     <li><span class="dfn-paneled" id="d7bc2287">queue a storage task</span>
     <li><span class="dfn-paneled" id="cd0c5fbe">quota</span>
     <li><span class="dfn-paneled" id="67130339">storage bottle</span>
     <li><span class="dfn-paneled" id="eb592b41">storage bottle map</span>
     <li><span class="dfn-paneled" id="6148dd37">storage bucket</span>
     <li><span class="dfn-paneled" id="cac8dd86">storage quota</span>
     <li><span class="dfn-paneled" id="daed3f4b">storage shelf</span>
     <li><span class="dfn-paneled" id="cb80877c">usage</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="583654a9">InvalidCharacterError</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
     <li><span class="dfn-paneled" id="8f5c2179">a promise resolved with</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
     <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-clear-site-data">[CLEAR-SITE-DATA]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-clear-site-data/"><cite>Clear Site Data</cite></a>. URL: <a href="https://w3c.github.io/webappsec-clear-site-data/">https://w3c.github.io/webappsec-clear-site-data/</a>
   <dt id="biblio-fs">[FS]
   <dd>Austin Sullivan. <a href="https://fs.spec.whatwg.org/"><cite>File System Standard</cite></a>. Living Standard. URL: <a href="https://fs.spec.whatwg.org/">https://fs.spec.whatwg.org/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-indexeddb-3">[IndexedDB-3]
   <dd>Joshua Bell. <a href="https://w3c.github.io/IndexedDB/"><cite>Indexed Database API 3.0</cite></a>. URL: <a href="https://w3c.github.io/IndexedDB/">https://w3c.github.io/IndexedDB/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions">[PERMISSIONS]
   <dd>Marcos Caceres; Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>Permissions</cite></a>. URL: <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-service-workers">[Service-Workers]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-storage">[Storage]
   <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. Living Standard. URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <a href="#navigatorstoragebuckets"><code><c- g>NavigatorStorageBuckets</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#storagebucketmanager"><c- n>StorageBucketManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StorageBucketManager" href="#dom-navigatorstoragebuckets-storagebuckets"><c- g>storageBuckets</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstoragebuckets"><c- n>NavigatorStorageBuckets</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstoragebuckets"><c- n>NavigatorStorageBuckets</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->),
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <a href="#storagebucketmanager"><code><c- g>StorageBucketManager</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#storagebucket"><c- n>StorageBucket</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucketmanager-open"><c- g>open</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-storagebucketmanager-open-name-options-name"><code><c- g>name</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-storagebucketoptions"><c- n>StorageBucketOptions</c-></a> <a href="#dom-storagebucketmanager-open-name-options-options"><code><c- g>options</c-></code></a> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-storagebucketmanager-keys"><c- g>keys</c-></a>();
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucketmanager-delete"><c- g>delete</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-storagebucketmanager-delete-name-name"><code><c- g>name</c-></code></a>);
};

<c- b>enum</c-> <a href="#enumdef-storagebucketdurability"><code><c- g>StorageBucketDurability</c-></code></a> {
  <a href="#dom-storagebucketdurability-strict"><code><c- s>"strict"</c-></code></a>,
  <a href="#dom-storagebucketdurability-relaxed"><code><c- s>"relaxed"</c-></code></a>
};

<c- b>dictionary</c-> <a href="#dictdef-storagebucketoptions"><code><c- g>StorageBucketOptions</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-storagebucketoptions-persisted"><code><c- g>persisted</c-></code></a> = <c- b>false</c->;
  <a data-link-type="idl-name" href="#enumdef-storagebucketdurability"><c- n>StorageBucketDurability</c-></a> <a data-default="null" data-type="StorageBucketDurability " href="#dom-storagebucketoptions-durability"><code><c- g>durability</c-></code></a> = <c- b>null</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a>? <a data-default="null" data-type="unsigned long long? " href="#dom-storagebucketoptions-quota"><code><c- g>quota</c-></code></a> = <c- b>null</c->;
  <a data-link-type="idl-name" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp"><c- n>DOMHighResTimeStamp</c-></a>? <a data-default="null" data-type="DOMHighResTimeStamp? " href="#dom-storagebucketoptions-expires"><code><c- g>expires</c-></code></a> = <c- b>null</c->;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->),
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <a href="#storagebucket"><code><c- g>StorageBucket</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-storagebucket-name"><c- g>name</c-></a>;

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-persist"><c- g>persist</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-persisted"><c- g>persisted</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://storage.spec.whatwg.org/#dictdef-storageestimate"><c- n>StorageEstimate</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-estimate"><c- g>estimate</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#enumdef-storagebucketdurability"><c- n>StorageBucketDurability</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-durability"><c- g>durability</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-setexpires"><c- g>setExpires</c-></a>(<a data-link-type="idl-name" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp"><c- n>DOMHighResTimeStamp</c-></a> <a href="#dom-storagebucket-setexpires-expires-expires"><code><c- g>expires</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp"><c- n>DOMHighResTimeStamp</c-></a>?> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-expires"><c- g>expires</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://w3c.github.io/IndexedDB/#idbfactory"><c- n>IDBFactory</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="IDBFactory" href="#dom-storagebucket-indexeddb"><c- g>indexedDB</c-></a>;

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#cachestorage"><c- n>CacheStorage</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="CacheStorage" href="#dom-storagebucket-caches"><c- g>caches</c-></a>;

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://fs.spec.whatwg.org/#filesystemdirectoryhandle"><c- n>FileSystemDirectoryHandle</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagebucket-getdirectory"><c- g>getDirectory</c-></a>();
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> <a data-link-type="biblio" href="#biblio-indexeddb-3" title="Indexed Database API 3.0">[IndexedDB-3]</a> needs to define how deletion occurs when data is evicted by quota. <a class="issue-return" href="#issue-4958726d" title="Jump to section">↵</a></div>
   <div class="issue"> <a data-link-type="biblio" href="#biblio-fs" title="File System Standard">[FS]</a> needs to define how deletion occurs for Origin Private File System when data is evicted by quota. <a class="issue-return" href="#issue-c5f1de1a" title="Jump to section">↵</a></div>
   <div class="issue"> <a data-link-type="biblio" href="#biblio-service-workers" title="Service Workers">[Service-Workers]</a> needs to define how deletion occurs for CacheStorage and Service Workers when data is evicted by quota. <a class="issue-return" href="#issue-2e7a487e" title="Jump to section">↵</a></div>
   <div class="issue"> Merge with <a href="https://storage.spec.whatwg.org/#buckets"><cite>Storage</cite> § 4.5 Storage buckets</a> which already defines <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-mode">bucket mode</a>. <a class="issue-return" href="#issue-3271f8e6" title="Jump to section">↵</a></div>
   <div class="issue"> <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory">IDBFactory</a></code> methods need to take a storage bottle map rather than a storageKey. <a class="issue-return" href="#issue-4f9abb58" title="Jump to section">↵</a></div>
   <div class="issue"> <a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[Storage]</a> needs to define helpers to retrieve the bottle map for a given (non-default) bucket. <a class="issue-return" href="#issue-0d9f1d43" title="Jump to section">↵</a></div>
   <div class="issue"> <a data-link-type="biblio" href="#biblio-fs" title="File System Standard">[FS]</a> needs to define a helper to retrieve an OPFS given a bottle map. <a class="issue-return" href="#issue-25ffaa8c" title="Jump to section">↵</a></div>
   <div class="issue"> Update <a href="https://w3c.github.io/webappsec-clear-site-data/#header"><cite>Clear Site Data</cite> § 3.1 The Clear-Site-Data HTTP Response Header Field</a>. <a class="issue-return" href="#issue-99cfd987" title="Jump to section">↵</a></div>
   <div class="issue"> add the steps below to the algorithm in <a href="https://w3c.github.io/webappsec-clear-site-data/#parsing"><cite>Clear Site Data</cite> § 4.1 Parsing</a>. <a class="issue-return" href="#issue-99223a67" title="Jump to section">↵</a></div>
   <div class="issue"> add the steps below to the algorithm in <a href="https://w3c.github.io/webappsec-clear-site-data/#clear-response"><cite>Clear Site Data</cite> § 4.2 Clear data for response</a>. <a class="issue-return" href="#issue-99223a67①" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['23e108bd'] = {"dfnID": "23e108bd", "url": "https://fs.spec.whatwg.org/#filesystemdirectoryhandle", "dfnText": "FileSystemDirectoryHandle", "refSections": [{"refs": [{"id": "ref-for-filesystemdirectoryhandle"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['4c10050a'] = {"dfnID": "4c10050a", "url": "https://fs.spec.whatwg.org/#dom-storagemanager-getdirectory", "dfnText": "getDirectory()", "refSections": [{"refs": [{"id": "ref-for-dom-storagemanager-getdirectory"}], "title": "2.5.3. Using an Origin Private File System"}], "external": true};
window.dfnpanelData['0e9f636b'] = {"dfnID": "0e9f636b", "url": "https://w3c.github.io/hr-time/#dom-domhighrestimestamp", "dfnText": "DOMHighResTimeStamp", "refSections": [{"refs": [{"id": "ref-for-dom-domhighrestimestamp"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-dom-domhighrestimestamp\u2460"}, {"id": "ref-for-dom-domhighrestimestamp\u2461"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['f16ee824'] = {"dfnID": "f16ee824", "url": "https://w3c.github.io/hr-time/#dfn-eso-current-wall-time", "dfnText": "current wall time", "refSections": [{"refs": [{"id": "ref-for-dfn-eso-current-wall-time"}, {"id": "ref-for-dfn-eso-current-wall-time\u2460"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['1e2edd5b'] = {"dfnID": "1e2edd5b", "url": "https://w3c.github.io/hr-time/#dfn-moment", "dfnText": "moment", "refSections": [{"refs": [{"id": "ref-for-dfn-moment"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['be5dbc8c'] = {"dfnID": "be5dbc8c", "url": "https://w3c.github.io/hr-time/#dfn-unix-epoch", "dfnText": "unix epoch", "refSections": [{"refs": [{"id": "ref-for-dfn-unix-epoch"}, {"id": "ref-for-dfn-unix-epoch\u2460"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-dfn-unix-epoch\u2461"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['05de5ae3'] = {"dfnID": "05de5ae3", "url": "https://w3c.github.io/hr-time/#dfn-wall-clock", "dfnText": "wall clock", "refSections": [{"refs": [{"id": "ref-for-dfn-wall-clock"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['be0c27b2'] = {"dfnID": "be0c27b2", "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator", "dfnText": "Navigator", "refSections": [{"refs": [{"id": "ref-for-navigator"}], "title": "1. The StorageBucketManager interface"}], "external": true};
window.dfnpanelData['a4785085'] = {"dfnID": "a4785085", "url": "https://html.spec.whatwg.org/multipage/workers.html#workernavigator", "dfnText": "WorkerNavigator", "refSections": [{"refs": [{"id": "ref-for-workernavigator"}], "title": "1. The StorageBucketManager interface"}], "external": true};
window.dfnpanelData['3e12e042'] = {"dfnID": "3e12e042", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "dfnText": "environment settings object", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object"}], "title": "1. The StorageBucketManager interface"}], "external": true};
window.dfnpanelData['a72449dd'] = {"dfnID": "a72449dd", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel", "dfnText": "in parallel", "refSections": [{"refs": [{"id": "ref-for-in-parallel"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-in-parallel\u2460"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-in-parallel\u2461"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['43ac8374'] = {"dfnID": "43ac8374", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-settings-object-origin"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2460"}, {"id": "ref-for-relevant-settings-object\u2461"}, {"id": "ref-for-relevant-settings-object\u2462"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2463"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2464"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2465"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2466"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['7ca1d370'] = {"dfnID": "7ca1d370", "url": "https://w3c.github.io/IndexedDB/#dom-idbtransactiondurability-default", "dfnText": "\"default\"", "refSections": [{"refs": [{"id": "ref-for-dom-idbtransactiondurability-default"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['e86b5ce4'] = {"dfnID": "e86b5ce4", "url": "https://w3c.github.io/IndexedDB/#dom-idbtransactiondurability-relaxed", "dfnText": "\"relaxed\"", "refSections": [{"refs": [{"id": "ref-for-dom-idbtransactiondurability-relaxed"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['5fd5f41c'] = {"dfnID": "5fd5f41c", "url": "https://w3c.github.io/IndexedDB/#dom-idbtransactiondurability-strict", "dfnText": "\"strict\"", "refSections": [{"refs": [{"id": "ref-for-dom-idbtransactiondurability-strict"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['78f41bd1'] = {"dfnID": "78f41bd1", "url": "https://w3c.github.io/IndexedDB/#idbfactory", "dfnText": "IDBFactory", "refSections": [{"refs": [{"id": "ref-for-idbfactory"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-idbfactory\u2460"}, {"id": "ref-for-idbfactory\u2461"}, {"id": "ref-for-idbfactory\u2462"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['668bd53e'] = {"dfnID": "668bd53e", "url": "https://w3c.github.io/IndexedDB/#idbtransaction", "dfnText": "IDBTransaction", "refSections": [{"refs": [{"id": "ref-for-idbtransaction"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-idbtransaction\u2460"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['a5cbd966'] = {"dfnID": "a5cbd966", "url": "https://w3c.github.io/IndexedDB/#transaction-durability-hint", "dfnText": "durability hint", "refSections": [{"refs": [{"id": "ref-for-transaction-durability-hint"}, {"id": "ref-for-transaction-durability-hint\u2460"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['53275e46'] = {"dfnID": "53275e46", "url": "https://infra.spec.whatwg.org/#list-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-list-append"}], "title": "1.3. Enumerating buckets"}], "external": true};
window.dfnpanelData['3b38c2fe'] = {"dfnID": "3b38c2fe", "url": "https://infra.spec.whatwg.org/#ascii-digit", "dfnText": "ascii digit", "refSections": [{"refs": [{"id": "ref-for-ascii-digit"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['5661d95e'] = {"dfnID": "5661d95e", "url": "https://infra.spec.whatwg.org/#ascii-lower-alpha", "dfnText": "ascii lower alpha", "refSections": [{"refs": [{"id": "ref-for-ascii-lower-alpha"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['915aff5e'] = {"dfnID": "915aff5e", "url": "https://infra.spec.whatwg.org/#code-point", "dfnText": "code point", "refSections": [{"refs": [{"id": "ref-for-code-point"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['4ef39030'] = {"dfnID": "4ef39030", "url": "https://infra.spec.whatwg.org/#string-code-point-length", "dfnText": "code point length", "refSections": [{"refs": [{"id": "ref-for-string-code-point-length"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['b8958cfc'] = {"dfnID": "b8958cfc", "url": "https://infra.spec.whatwg.org/#code-unit-substring-by-positions", "dfnText": "code unit substring by positions", "refSections": [{"refs": [{"id": "ref-for-code-unit-substring-by-positions"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['860300d4'] = {"dfnID": "860300d4", "url": "https://infra.spec.whatwg.org/#implementation-defined", "dfnText": "implementation-defined", "refSections": [{"refs": [{"id": "ref-for-implementation-defined"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['d14a6f26'] = {"dfnID": "d14a6f26", "url": "https://infra.spec.whatwg.org/#map-key", "dfnText": "key", "refSections": [{"refs": [{"id": "ref-for-map-key"}], "title": "1.2. Deleting a bucket"}], "external": true};
window.dfnpanelData['649608b9'] = {"dfnID": "649608b9", "url": "https://infra.spec.whatwg.org/#list", "dfnText": "list", "refSections": [{"refs": [{"id": "ref-for-list"}], "title": "1.3. Enumerating buckets"}], "external": true};
window.dfnpanelData['54627f47'] = {"dfnID": "54627f47", "url": "https://infra.spec.whatwg.org/#string-starts-with", "dfnText": "starts with", "refSections": [{"refs": [{"id": "ref-for-string-starts-with"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['0e8de730'] = {"dfnID": "0e8de730", "url": "https://infra.spec.whatwg.org/#tuple", "dfnText": "tuple", "refSections": [{"refs": [{"id": "ref-for-tuple"}, {"id": "ref-for-tuple\u2460"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['33438879'] = {"dfnID": "33438879", "url": "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state", "dfnText": "getting the current permission state", "refSections": [{"refs": [{"id": "ref-for-dfn-getting-the-current-permission-state"}], "title": "2.1. Persistence"}], "external": true};
window.dfnpanelData['c6ce3c60'] = {"dfnID": "c6ce3c60", "url": "https://w3c.github.io/permissions/#dom-permissionstate-granted", "dfnText": "granted", "refSections": [{"refs": [{"id": "ref-for-dom-permissionstate-granted"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-dom-permissionstate-granted\u2460"}], "title": "2.1. Persistence"}], "external": true};
window.dfnpanelData['d357c753'] = {"dfnID": "d357c753", "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use", "dfnText": "requesting permission to use", "refSections": [{"refs": [{"id": "ref-for-dfn-request-permission-to-use"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['f747b195'] = {"dfnID": "f747b195", "url": "https://w3c.github.io/ServiceWorker/#cachestorage", "dfnText": "CacheStorage", "refSections": [{"refs": [{"id": "ref-for-cachestorage"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-cachestorage\u2460"}, {"id": "ref-for-cachestorage\u2461"}], "title": "2.5.2. Using CacheStorage"}], "external": true};
window.dfnpanelData['e7e8a4f7'] = {"dfnID": "e7e8a4f7", "url": "https://w3c.github.io/ServiceWorker/#dfn-relevant-name-to-cache-map", "dfnText": "relevant name to cache map", "refSections": [{"refs": [{"id": "ref-for-dfn-relevant-name-to-cache-map"}], "title": "2.5.2. Using CacheStorage"}], "external": true};
window.dfnpanelData['48a84355'] = {"dfnID": "48a84355", "url": "https://storage.spec.whatwg.org/#dictdef-storageestimate", "dfnText": "StorageEstimate", "refSections": [{"refs": [{"id": "ref-for-dictdef-storageestimate"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-dictdef-storageestimate\u2460"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['7db4a4b7'] = {"dfnID": "7db4a4b7", "url": "https://storage.spec.whatwg.org/#bucket-map", "dfnText": "bucket map", "refSections": [{"refs": [{"id": "ref-for-bucket-map"}, {"id": "ref-for-bucket-map\u2460"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-bucket-map\u2461"}, {"id": "ref-for-bucket-map\u2462"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-bucket-map\u2463"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-bucket-map\u2464"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-bucket-map\u2465"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['b9712e0a'] = {"dfnID": "b9712e0a", "url": "https://storage.spec.whatwg.org/#bucket-mode", "dfnText": "bucket mode", "refSections": [{"refs": [{"id": "ref-for-bucket-mode"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-bucket-mode\u2460"}, {"id": "ref-for-bucket-mode\u2461"}, {"id": "ref-for-bucket-mode\u2462"}, {"id": "ref-for-bucket-mode\u2463"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-bucket-mode\u2464"}, {"id": "ref-for-bucket-mode\u2465"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['6bb9d790'] = {"dfnID": "6bb9d790", "url": "https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map", "dfnText": "obtain a local storage bottle map", "refSections": [{"refs": [{"id": "ref-for-obtain-a-local-storage-bottle-map"}], "title": "2.5.1. Using Indexed Database"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-bottle-map\u2460"}], "title": "2.5.2. Using CacheStorage"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-bottle-map\u2461"}], "title": "2.5.3. Using an Origin Private File System"}], "external": true};
window.dfnpanelData['caa5107f'] = {"dfnID": "caa5107f", "url": "https://storage.spec.whatwg.org/#obtain-a-local-storage-shelf", "dfnText": "obtain a local storage shelf", "refSections": [{"refs": [{"id": "ref-for-obtain-a-local-storage-shelf"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-shelf\u2460"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-shelf\u2461"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-shelf\u2462"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-shelf\u2463"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['d7bc2287'] = {"dfnID": "d7bc2287", "url": "https://storage.spec.whatwg.org/#queue-a-storage-task", "dfnText": "queue a storage task", "refSections": [{"refs": [{"id": "ref-for-queue-a-storage-task"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-queue-a-storage-task\u2460"}, {"id": "ref-for-queue-a-storage-task\u2461"}, {"id": "ref-for-queue-a-storage-task\u2462"}, {"id": "ref-for-queue-a-storage-task\u2463"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-queue-a-storage-task\u2464"}, {"id": "ref-for-queue-a-storage-task\u2465"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-queue-a-storage-task\u2466"}, {"id": "ref-for-queue-a-storage-task\u2467"}, {"id": "ref-for-queue-a-storage-task\u2468"}, {"id": "ref-for-queue-a-storage-task\u2460\u24ea"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['cd0c5fbe'] = {"dfnID": "cd0c5fbe", "url": "https://storage.spec.whatwg.org/#dom-storageestimate-quota", "dfnText": "quota", "refSections": [{"refs": [{"id": "ref-for-dom-storageestimate-quota"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['67130339'] = {"dfnID": "67130339", "url": "https://storage.spec.whatwg.org/#storage-bottle", "dfnText": "storage bottle", "refSections": [{"refs": [{"id": "ref-for-storage-bottle"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['eb592b41'] = {"dfnID": "eb592b41", "url": "https://storage.spec.whatwg.org/#storage-bottle-map", "dfnText": "storage bottle map", "refSections": [{"refs": [{"id": "ref-for-storage-bottle-map"}], "title": "2.5.1. Using Indexed Database"}], "external": true};
window.dfnpanelData['6148dd37'] = {"dfnID": "6148dd37", "url": "https://storage.spec.whatwg.org/#storage-bucket", "dfnText": "storage bucket", "refSections": [{"refs": [{"id": "ref-for-storage-bucket"}, {"id": "ref-for-storage-bucket\u2460"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-storage-bucket\u2461"}, {"id": "ref-for-storage-bucket\u2462"}, {"id": "ref-for-storage-bucket\u2463"}, {"id": "ref-for-storage-bucket\u2464"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-storage-bucket\u2465"}, {"id": "ref-for-storage-bucket\u2466"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-storage-bucket\u2467"}, {"id": "ref-for-storage-bucket\u2468"}, {"id": "ref-for-storage-bucket\u2460\u24ea"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-storage-bucket\u2460\u2460"}, {"id": "ref-for-storage-bucket\u2460\u2461"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-storage-bucket\u2460\u2462"}, {"id": "ref-for-storage-bucket\u2460\u2463"}, {"id": "ref-for-storage-bucket\u2460\u2464"}], "title": "2.4. Expiration"}, {"refs": [{"id": "ref-for-storage-bucket\u2460\u2465"}], "title": "2.5.1. Using Indexed Database"}, {"refs": [{"id": "ref-for-storage-bucket\u2460\u2466"}], "title": "2.5.2. Using CacheStorage"}, {"refs": [{"id": "ref-for-storage-bucket\u2460\u2467"}], "title": "2.5.3. Using an Origin Private File System"}, {"refs": [{"id": "ref-for-storage-bucket\u2460\u2468"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['cac8dd86'] = {"dfnID": "cac8dd86", "url": "https://storage.spec.whatwg.org/#storage-quota", "dfnText": "storage quota", "refSections": [{"refs": [{"id": "ref-for-storage-quota"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['daed3f4b'] = {"dfnID": "daed3f4b", "url": "https://storage.spec.whatwg.org/#storage-shelf", "dfnText": "storage shelf", "refSections": [{"refs": [{"id": "ref-for-storage-shelf"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['cb80877c'] = {"dfnID": "cb80877c", "url": "https://storage.spec.whatwg.org/#dom-storageestimate-usage", "dfnText": "usage", "refSections": [{"refs": [{"id": "ref-for-dom-storageestimate-usage"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['8855a9aa'] = {"dfnID": "8855a9aa", "url": "https://webidl.spec.whatwg.org/#idl-DOMString", "dfnText": "DOMString", "refSections": [{"refs": [{"id": "ref-for-idl-DOMString"}, {"id": "ref-for-idl-DOMString\u2460"}, {"id": "ref-for-idl-DOMString\u2461"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-idl-DOMString\u2462"}, {"id": "ref-for-idl-DOMString\u2463"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['889e932f'] = {"dfnID": "889e932f", "url": "https://webidl.spec.whatwg.org/#Exposed", "dfnText": "Exposed", "refSections": [{"refs": [{"id": "ref-for-Exposed"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-Exposed\u2460"}, {"id": "ref-for-Exposed\u2461"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['583654a9'] = {"dfnID": "583654a9", "url": "https://webidl.spec.whatwg.org/#invalidcharactererror", "dfnText": "InvalidCharacterError", "refSections": [{"refs": [{"id": "ref-for-invalidcharactererror"}], "title": "1.2. Deleting a bucket"}], "external": true};
window.dfnpanelData['797018a7'] = {"dfnID": "797018a7", "url": "https://webidl.spec.whatwg.org/#invalidstateerror", "dfnText": "InvalidStateError", "refSections": [{"refs": [{"id": "ref-for-invalidstateerror"}, {"id": "ref-for-invalidstateerror\u2460"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-invalidstateerror\u2461"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-invalidstateerror\u2462"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-invalidstateerror\u2463"}, {"id": "ref-for-invalidstateerror\u2464"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['bdbd19d1'] = {"dfnID": "bdbd19d1", "url": "https://webidl.spec.whatwg.org/#idl-promise", "dfnText": "Promise", "refSections": [{"refs": [{"id": "ref-for-idl-promise"}, {"id": "ref-for-idl-promise\u2460"}, {"id": "ref-for-idl-promise\u2461"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-idl-promise\u2462"}, {"id": "ref-for-idl-promise\u2463"}, {"id": "ref-for-idl-promise\u2464"}, {"id": "ref-for-idl-promise\u2465"}, {"id": "ref-for-idl-promise\u2466"}, {"id": "ref-for-idl-promise\u2467"}, {"id": "ref-for-idl-promise\u2468"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['a5c91173'] = {"dfnID": "a5c91173", "url": "https://webidl.spec.whatwg.org/#SameObject", "dfnText": "SameObject", "refSections": [{"refs": [{"id": "ref-for-SameObject"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-SameObject\u2460"}, {"id": "ref-for-SameObject\u2461"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['b75bb3bd'] = {"dfnID": "b75bb3bd", "url": "https://webidl.spec.whatwg.org/#SecureContext", "dfnText": "SecureContext", "refSections": [{"refs": [{"id": "ref-for-SecureContext"}, {"id": "ref-for-SecureContext\u2460"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-SecureContext\u2461"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['82ca3efc'] = {"dfnID": "82ca3efc", "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror", "dfnText": "TypeError", "refSections": [{"refs": [{"id": "ref-for-exceptiondef-typeerror"}, {"id": "ref-for-exceptiondef-typeerror\u2460"}, {"id": "ref-for-exceptiondef-typeerror\u2461"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-exceptiondef-typeerror\u2462"}, {"id": "ref-for-exceptiondef-typeerror\u2463"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-exceptiondef-typeerror\u2464"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-exceptiondef-typeerror\u2465"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-exceptiondef-typeerror\u2466"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['dacde8b5'] = {"dfnID": "dacde8b5", "url": "https://webidl.spec.whatwg.org/#a-new-promise", "dfnText": "a new promise", "refSections": [{"refs": [{"id": "ref-for-a-new-promise"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-a-new-promise\u2460"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-a-new-promise\u2461"}, {"id": "ref-for-a-new-promise\u2462"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-a-new-promise\u2463"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-a-new-promise\u2464"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-a-new-promise\u2465"}, {"id": "ref-for-a-new-promise\u2466"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['d0b4a948'] = {"dfnID": "d0b4a948", "url": "https://webidl.spec.whatwg.org/#a-promise-rejected-with", "dfnText": "a promise rejected with", "refSections": [{"refs": [{"id": "ref-for-a-promise-rejected-with"}, {"id": "ref-for-a-promise-rejected-with\u2460"}, {"id": "ref-for-a-promise-rejected-with\u2461"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-a-promise-rejected-with\u2462"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-a-promise-rejected-with\u2463"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-a-promise-rejected-with\u2464"}, {"id": "ref-for-a-promise-rejected-with\u2465"}], "title": "2.2. Quota"}], "external": true};
window.dfnpanelData['8f5c2179'] = {"dfnID": "8f5c2179", "url": "https://webidl.spec.whatwg.org/#a-promise-resolved-with", "dfnText": "a promise resolved with", "refSections": [{"refs": [{"id": "ref-for-a-promise-resolved-with"}], "title": "1.1. Creating a bucket"}], "external": true};
window.dfnpanelData['5372cca8'] = {"dfnID": "5372cca8", "url": "https://webidl.spec.whatwg.org/#idl-boolean", "dfnText": "boolean", "refSections": [{"refs": [{"id": "ref-for-idl-boolean"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-idl-boolean\u2460"}, {"id": "ref-for-idl-boolean\u2461"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['b262501e'] = {"dfnID": "b262501e", "url": "https://webidl.spec.whatwg.org/#reject", "dfnText": "reject", "refSections": [{"refs": [{"id": "ref-for-reject"}, {"id": "ref-for-reject\u2460"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-reject\u2461"}, {"id": "ref-for-reject\u2462"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-reject\u2463"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-reject\u2464"}, {"id": "ref-for-reject\u2465"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['3b90bdcd'] = {"dfnID": "3b90bdcd", "url": "https://webidl.spec.whatwg.org/#resolve", "dfnText": "resolve", "refSections": [{"refs": [{"id": "ref-for-resolve"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-resolve\u2460"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-resolve\u2461"}, {"id": "ref-for-resolve\u2462"}, {"id": "ref-for-resolve\u2463"}, {"id": "ref-for-resolve\u2464"}, {"id": "ref-for-resolve\u2465"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-resolve\u2466"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-resolve\u2467"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-resolve\u2468"}, {"id": "ref-for-resolve\u2460\u24ea"}], "title": "2.4. Expiration"}], "external": true};
window.dfnpanelData['9cce47fd'] = {"dfnID": "9cce47fd", "url": "https://webidl.spec.whatwg.org/#idl-sequence", "dfnText": "sequence", "refSections": [{"refs": [{"id": "ref-for-idl-sequence"}], "title": "1. The StorageBucketManager interface"}], "external": true};
window.dfnpanelData['4013a022'] = {"dfnID": "4013a022", "url": "https://webidl.spec.whatwg.org/#this", "dfnText": "this", "refSections": [{"refs": [{"id": "ref-for-this"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-this\u2460"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-this\u2461"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-this\u2462"}, {"id": "ref-for-this\u2463"}, {"id": "ref-for-this\u2464"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-this\u2465"}, {"id": "ref-for-this\u2466"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-this\u2467"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-this\u2468"}, {"id": "ref-for-this\u2460\u24ea"}], "title": "2.4. Expiration"}, {"refs": [{"id": "ref-for-this\u2460\u2460"}, {"id": "ref-for-this\u2460\u2461"}, {"id": "ref-for-this\u2460\u2462"}, {"id": "ref-for-this\u2460\u2463"}], "title": "2.5.1. Using Indexed Database"}, {"refs": [{"id": "ref-for-this\u2460\u2464"}, {"id": "ref-for-this\u2460\u2465"}, {"id": "ref-for-this\u2460\u2466"}, {"id": "ref-for-this\u2460\u2467"}], "title": "2.5.2. Using CacheStorage"}, {"refs": [{"id": "ref-for-this\u2460\u2468"}], "title": "2.5.3. Using an Origin Private File System"}, {"refs": [{"id": "ref-for-this\u2461\u24ea"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['b4cfa5ce'] = {"dfnID": "b4cfa5ce", "url": "https://webidl.spec.whatwg.org/#dfn-throw", "dfnText": "throw", "refSections": [{"refs": [{"id": "ref-for-dfn-throw"}], "title": "2.6. Clear Site Data integration"}], "external": true};
window.dfnpanelData['5f90bbfb'] = {"dfnID": "5f90bbfb", "url": "https://webidl.spec.whatwg.org/#idl-undefined", "dfnText": "undefined", "refSections": [{"refs": [{"id": "ref-for-idl-undefined"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-idl-undefined\u2460"}], "title": "2. The StorageBucket interface"}], "external": true};
window.dfnpanelData['f14b47b8'] = {"dfnID": "f14b47b8", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long", "dfnText": "unsigned long long", "refSections": [{"refs": [{"id": "ref-for-idl-unsigned-long-long"}], "title": "1. The StorageBucketManager interface"}], "external": true};
window.dfnpanelData['navigatorstoragebuckets'] = {"dfnID": "navigatorstoragebuckets", "url": "#navigatorstoragebuckets", "dfnText": "NavigatorStorageBuckets", "refSections": [{"refs": [{"id": "ref-for-navigatorstoragebuckets"}, {"id": "ref-for-navigatorstoragebuckets\u2460"}], "title": "1. The StorageBucketManager interface"}], "external": false};
window.dfnpanelData['dom-navigatorstoragebuckets-storagebuckets'] = {"dfnID": "dom-navigatorstoragebuckets-storagebuckets", "url": "#dom-navigatorstoragebuckets-storagebuckets", "dfnText": "storageBuckets", "refSections": [{"refs": [{"id": "ref-for-dom-navigatorstoragebuckets-storagebuckets"}], "title": "1. The StorageBucketManager interface"}], "external": false};
window.dfnpanelData['storagebucketmanager'] = {"dfnID": "storagebucketmanager", "url": "#storagebucketmanager", "dfnText": "StorageBucketManager", "refSections": [{"refs": [{"id": "ref-for-storagebucketmanager"}, {"id": "ref-for-storagebucketmanager\u2460"}, {"id": "ref-for-storagebucketmanager\u2461"}, {"id": "ref-for-storagebucketmanager\u2462"}], "title": "1. The StorageBucketManager interface"}], "external": false};
window.dfnpanelData['enumdef-storagebucketdurability'] = {"dfnID": "enumdef-storagebucketdurability", "url": "#enumdef-storagebucketdurability", "dfnText": "StorageBucketDurability", "refSections": [{"refs": [{"id": "ref-for-enumdef-storagebucketdurability"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-enumdef-storagebucketdurability\u2460"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-enumdef-storagebucketdurability\u2461"}], "title": "2.3. Durability"}], "external": false};
window.dfnpanelData['dom-storagebucketdurability-strict'] = {"dfnID": "dom-storagebucketdurability-strict", "url": "#dom-storagebucketdurability-strict", "dfnText": "\"strict\"", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketdurability-strict"}, {"id": "ref-for-dom-storagebucketdurability-strict\u2460"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-dom-storagebucketdurability-strict\u2461"}], "title": "2.5.1. Using Indexed Database"}], "external": false};
window.dfnpanelData['dom-storagebucketdurability-relaxed'] = {"dfnID": "dom-storagebucketdurability-relaxed", "url": "#dom-storagebucketdurability-relaxed", "dfnText": "\"relaxed\"", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketdurability-relaxed"}, {"id": "ref-for-dom-storagebucketdurability-relaxed\u2460"}], "title": "2.3. Durability"}], "external": false};
window.dfnpanelData['dictdef-storagebucketoptions'] = {"dfnID": "dictdef-storagebucketoptions", "url": "#dictdef-storagebucketoptions", "dfnText": "StorageBucketOptions", "refSections": [{"refs": [{"id": "ref-for-dictdef-storagebucketoptions"}], "title": "1. The StorageBucketManager interface"}], "external": false};
window.dfnpanelData['dom-storagebucketoptions-persisted'] = {"dfnID": "dom-storagebucketoptions-persisted", "url": "#dom-storagebucketoptions-persisted", "dfnText": "persisted", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketoptions-persisted"}], "title": "1.1. Creating a bucket"}], "external": false};
window.dfnpanelData['dom-storagebucketoptions-durability'] = {"dfnID": "dom-storagebucketoptions-durability", "url": "#dom-storagebucketoptions-durability", "dfnText": "durability", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketoptions-durability"}, {"id": "ref-for-dom-storagebucketoptions-durability\u2460"}], "title": "1.1. Creating a bucket"}], "external": false};
window.dfnpanelData['dom-storagebucketoptions-quota'] = {"dfnID": "dom-storagebucketoptions-quota", "url": "#dom-storagebucketoptions-quota", "dfnText": "quota", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketoptions-quota"}, {"id": "ref-for-dom-storagebucketoptions-quota\u2460"}], "title": "1.1. Creating a bucket"}], "external": false};
window.dfnpanelData['dom-storagebucketoptions-expires'] = {"dfnID": "dom-storagebucketoptions-expires", "url": "#dom-storagebucketoptions-expires", "dfnText": "expires", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketoptions-expires"}, {"id": "ref-for-dom-storagebucketoptions-expires\u2460"}], "title": "1.1. Creating a bucket"}], "external": false};
window.dfnpanelData['dom-storagebucketmanager-open'] = {"dfnID": "dom-storagebucketmanager-open", "url": "#dom-storagebucketmanager-open", "dfnText": "open(name, options)", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketmanager-open"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-dom-storagebucketmanager-open\u2460"}, {"id": "ref-for-dom-storagebucketmanager-open\u2461"}], "title": "2.4. Expiration"}], "external": false};
window.dfnpanelData['open-a-bucket'] = {"dfnID": "open-a-bucket", "url": "#open-a-bucket", "dfnText": "open a bucket", "refSections": [{"refs": [{"id": "ref-for-open-a-bucket"}], "title": "1.1. Creating a bucket"}], "external": false};
window.dfnpanelData['validate-a-bucket-name'] = {"dfnID": "validate-a-bucket-name", "url": "#validate-a-bucket-name", "dfnText": "validate a bucket name", "refSections": [{"refs": [{"id": "ref-for-validate-a-bucket-name"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-validate-a-bucket-name\u2460"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-validate-a-bucket-name\u2461"}], "title": "2.6. Clear Site Data integration"}], "external": false};
window.dfnpanelData['get-or-expire-a-bucket'] = {"dfnID": "get-or-expire-a-bucket", "url": "#get-or-expire-a-bucket", "dfnText": "get or expire a bucket", "refSections": [{"refs": [{"id": "ref-for-get-or-expire-a-bucket"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-get-or-expire-a-bucket\u2460"}], "title": "1.3. Enumerating buckets"}, {"refs": [{"id": "ref-for-get-or-expire-a-bucket\u2461"}], "title": "2.4. Expiration"}], "external": false};
window.dfnpanelData['dom-storagebucketmanager-delete'] = {"dfnID": "dom-storagebucketmanager-delete", "url": "#dom-storagebucketmanager-delete", "dfnText": "delete(name)", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketmanager-delete"}], "title": "1. The StorageBucketManager interface"}], "external": false};
window.dfnpanelData['remove-a-bucket'] = {"dfnID": "remove-a-bucket", "url": "#remove-a-bucket", "dfnText": "remove a bucket", "refSections": [{"refs": [{"id": "ref-for-remove-a-bucket"}], "title": "1.2. Deleting a bucket"}], "external": false};
window.dfnpanelData['dom-storagebucketmanager-keys'] = {"dfnID": "dom-storagebucketmanager-keys", "url": "#dom-storagebucketmanager-keys", "dfnText": "keys()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucketmanager-keys"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-dom-storagebucketmanager-keys\u2460"}, {"id": "ref-for-dom-storagebucketmanager-keys\u2461"}], "title": "2.4. Expiration"}], "external": false};
window.dfnpanelData['storagebucket'] = {"dfnID": "storagebucket", "url": "#storagebucket", "dfnText": "StorageBucket", "refSections": [{"refs": [{"id": "ref-for-storagebucket"}], "title": "1. The StorageBucketManager interface"}, {"refs": [{"id": "ref-for-storagebucket\u2460"}, {"id": "ref-for-storagebucket\u2461"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-storagebucket\u2462"}, {"id": "ref-for-storagebucket\u2463"}, {"id": "ref-for-storagebucket\u2464"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-storagebucket\u2465"}], "title": "2.5.1. Using Indexed Database"}, {"refs": [{"id": "ref-for-storagebucket\u2466"}], "title": "2.5.2. Using CacheStorage"}], "external": false};
window.dfnpanelData['storage-bucket-removed'] = {"dfnID": "storage-bucket-removed", "url": "#storage-bucket-removed", "dfnText": "removed", "refSections": [{"refs": [{"id": "ref-for-storage-bucket-removed"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-storage-bucket-removed\u2460"}], "title": "1.2. Deleting a bucket"}, {"refs": [{"id": "ref-for-storage-bucket-removed\u2461"}, {"id": "ref-for-storage-bucket-removed\u2462"}], "title": "2.1. Persistence"}, {"refs": [{"id": "ref-for-storage-bucket-removed\u2463"}], "title": "2.2. Quota"}, {"refs": [{"id": "ref-for-storage-bucket-removed\u2464"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-storage-bucket-removed\u2465"}, {"id": "ref-for-storage-bucket-removed\u2466"}], "title": "2.4. Expiration"}], "external": false};
window.dfnpanelData['dom-storagebucket-name'] = {"dfnID": "dom-storagebucket-name", "url": "#dom-storagebucket-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-name"}], "title": "2. The StorageBucket interface"}], "external": false};
window.dfnpanelData['dom-storagebucket-persist'] = {"dfnID": "dom-storagebucket-persist", "url": "#dom-storagebucket-persist", "dfnText": "persist()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-persist"}], "title": "2. The StorageBucket interface"}], "external": false};
window.dfnpanelData['dom-storagebucket-persisted'] = {"dfnID": "dom-storagebucket-persisted", "url": "#dom-storagebucket-persisted", "dfnText": "persisted()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-persisted"}], "title": "2. The StorageBucket interface"}], "external": false};
window.dfnpanelData['storagebucket-quota-value'] = {"dfnID": "storagebucket-quota-value", "url": "#storagebucket-quota-value", "dfnText": "quota value", "refSections": [{"refs": [{"id": "ref-for-storagebucket-quota-value"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-storagebucket-quota-value\u2460"}, {"id": "ref-for-storagebucket-quota-value\u2461"}], "title": "2.2. Quota"}], "external": false};
window.dfnpanelData['storage-bucket-storage-usage'] = {"dfnID": "storage-bucket-storage-usage", "url": "#storage-bucket-storage-usage", "dfnText": "storage usage", "refSections": [{"refs": [{"id": "ref-for-storage-bucket-storage-usage"}], "title": "2.2. Quota"}], "external": false};
window.dfnpanelData['dom-storagebucket-estimate'] = {"dfnID": "dom-storagebucket-estimate", "url": "#dom-storagebucket-estimate", "dfnText": "estimate()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-estimate"}], "title": "2. The StorageBucket interface"}], "external": false};
window.dfnpanelData['storagebucket-durability-value'] = {"dfnID": "storagebucket-durability-value", "url": "#storagebucket-durability-value", "dfnText": "durability value", "refSections": [{"refs": [{"id": "ref-for-storagebucket-durability-value"}, {"id": "ref-for-storagebucket-durability-value\u2460"}, {"id": "ref-for-storagebucket-durability-value\u2461"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-storagebucket-durability-value\u2462"}, {"id": "ref-for-storagebucket-durability-value\u2463"}, {"id": "ref-for-storagebucket-durability-value\u2464"}, {"id": "ref-for-storagebucket-durability-value\u2465"}], "title": "2.3. Durability"}, {"refs": [{"id": "ref-for-storagebucket-durability-value\u2466"}, {"id": "ref-for-storagebucket-durability-value\u2467"}], "title": "2.5.1. Using Indexed Database"}], "external": false};
window.dfnpanelData['dom-storagebucket-durability'] = {"dfnID": "dom-storagebucket-durability", "url": "#dom-storagebucket-durability", "dfnText": "durability()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-durability"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-dom-storagebucket-durability\u2460"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-dom-storagebucket-durability\u2461"}], "title": "2.3. Durability"}], "external": false};
window.dfnpanelData['storagebucket-expiration-time'] = {"dfnID": "storagebucket-expiration-time", "url": "#storagebucket-expiration-time", "dfnText": "expiration time", "refSections": [{"refs": [{"id": "ref-for-storagebucket-expiration-time"}, {"id": "ref-for-storagebucket-expiration-time\u2460"}], "title": "1.1. Creating a bucket"}, {"refs": [{"id": "ref-for-storagebucket-expiration-time\u2461"}, {"id": "ref-for-storagebucket-expiration-time\u2462"}, {"id": "ref-for-storagebucket-expiration-time\u2463"}], "title": "2.4. Expiration"}], "external": false};
window.dfnpanelData['dom-storagebucket-setexpires'] = {"dfnID": "dom-storagebucket-setexpires", "url": "#dom-storagebucket-setexpires", "dfnText": "setExpires(expires)", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-setexpires"}], "title": "2. The StorageBucket interface"}], "external": false};
window.dfnpanelData['dom-storagebucket-expires'] = {"dfnID": "dom-storagebucket-expires", "url": "#dom-storagebucket-expires", "dfnText": "expires()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-expires"}], "title": "2. The StorageBucket interface"}], "external": false};
window.dfnpanelData['dom-storagebucket-indexeddb'] = {"dfnID": "dom-storagebucket-indexeddb", "url": "#dom-storagebucket-indexeddb", "dfnText": "indexedDB", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-indexeddb"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-dom-storagebucket-indexeddb\u2460"}, {"id": "ref-for-dom-storagebucket-indexeddb\u2461"}, {"id": "ref-for-dom-storagebucket-indexeddb\u2462"}], "title": "2.5.1. Using Indexed Database"}], "external": false};
window.dfnpanelData['dom-storagebucket-caches'] = {"dfnID": "dom-storagebucket-caches", "url": "#dom-storagebucket-caches", "dfnText": "caches", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-caches"}], "title": "2. The StorageBucket interface"}, {"refs": [{"id": "ref-for-dom-storagebucket-caches\u2460"}, {"id": "ref-for-dom-storagebucket-caches\u2461"}, {"id": "ref-for-dom-storagebucket-caches\u2462"}], "title": "2.5.2. Using CacheStorage"}], "external": false};
window.dfnpanelData['dom-storagebucket-getdirectory'] = {"dfnID": "dom-storagebucket-getdirectory", "url": "#dom-storagebucket-getdirectory", "dfnText": "getDirectory()", "refSections": [{"refs": [{"id": "ref-for-dom-storagebucket-getdirectory"}], "title": "2. The StorageBucket interface"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>